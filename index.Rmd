---
title: "Importance and Favored Team Performance in NBA Games"
author: "Jonah Karafiol"
description: "A Statistical Analysis Utilizing 538's Elo and Importance"
output:
  distill::distill_article:
    self_contained: false
---

```{r}
library(ggplot2)
library(dplyr)
library(readr)
```
## Introduction
Any competitive athlete knows that under pressure, performance takes a hit. Nerves make it difficult to play to the best of our abilities, and while professional athletes often utilize mental training to mitigate these negative effects, there are countless examples of player performance taking a hit under pressure: a kicker double-doinking a game winning field goal, or an NBA player bricking the go-ahead free throw. This research project set out to explore this problem through the lens of basketball, asking: how does importance impact how basketball teams perform? I hypothesize that when estimated importance is higher, favored teams will win a lower proportion of games as opposed to when estimated importance is lower, due to the added pressure of the perceived importance. 

The unit of analysis is an NBA game, and the explanatory variable is interest as measured by 538. Importance is the extent to which a game impacted NBA Championship odds, using data from the 2022-2023 NBA season. When teams win games, they increase the chance that they will make the playoffs, and they also decrease the chance that other teams will make the NBA playoffs. Of course, the more likely a team is to make the playoffs, the more likely they are to win the championship, although occasionally teams with lower playoff odds will have higher championship odds. My outcome variable is winning, specifically if the favored team won. I assigned favorite-status and underdog-status based on 538's elo ratings. We'd expect favorites to win more often than not in both low- and high-importance games if importance had no impact on outcome. This research is important because performance is not unique to sports games: doctors, firefighters, and just about every other professional is put in high-pressure situations at some point or another. Moreover, students must take extremely important exams, like their finals or standardized tests. Knowing how NBA players perform under pressure will allow us to draw insights into other fields, as well as consider how effective the interventions NBA players undergo to prevent nerves from impacting their performance really are.

## Data
This is a cross-sectional study; data was collected at a single point in time following the NBA Season, and I examined the relationship between importance and the performance of the favored team. The data source is the entire catalog of games from the 2022-2023 NBA Season. Each game was assigned an importance rating prior to the game; additionally, both teams competing in a game were assigned elos before the game. Per fivethirtyeight.com, importance is calculated differently depending on outcomes in different sports. For instance, in the Premiere League, importance not only measures final standings, but also the odds of making the Champions League or being relegated. In the NBA, the outcomes are championship and playoff odds. 538 calculates these odds conditional on a particular team winning and losing before taking the difference between them. They then take the factor with the maximum range of difference for each team and scale the value to be between 0 and 100, before averaging the two competitors' individual importance measures. The other important variable is RAPTOR, which is 538's own elo measure. In the season in question, RAPTOR ranged from the Nuggets' 1719 to the Piston's 1299. The model rose to fame after it correctly forecasted the 2018-2019 Toronto Raptor's NBA Championship win over the Golden State Warriors. The implied odds of the Warriors winning the championship were approximately 25 percent, making the model's forecast incredibly impressive. RAPTOR individually rates players in two ways: a box score component that uses individual player stats, and an on-off component that measures team performance when a player is on or off the court.

I will now further describe the RAPTOR method: RAPTOR starts with the insights from RAPM, or real adjusted plus-minus, which measures point differential when a player is on the court. RAPM attempts to measure the value that a player contributes to his team's ability to outscore and out defend their opponents. RAPTOR measures offense in four categories: scoring and usage; passing; rebounding; and space creation. Then, it measures defense with: steals; fouls drawn; opponent field goal percentage; defensive rebounds; and points scored by the opponent the player in question is supposed to be guarding. RAPTOR uses individual stats by adjusting them relative to league average before regressing them against RAPM, and it also controls for these outliers like Javale McGee on a 67-win Warriors team that didn't really make force him to play all that well to win. It attempts to control for for the mediocre player, amazing team problem. Players with amazing teammates will find it easier to make shots, dish out assists, and get rebounds on the offensive side of the ball, and players with phenomenal defenders on their team will get bailed out by the skill of their teammates. Some players appear to be much better than they are because they are on an amazing team: regardless of how well they play, the rest of their team will ensure that they outperform their opponents. To get from individual ratings to a team rating, the sum of all individual ratings on a team is multiplied by .8 in the regular season and .9 in the playoffs. I used RAPTOR and wins to create a new variable called fav_won that measured if the team with the higher RAPTOR elo won. I also created a variable called elo_gap that measures how wide the gap between the favorite and the underdog was; this is important in measuring magnitude, since it is possible that past a certain elo gap, importance ceases to be important. For instance, even if the entire world was watching, no college football team would ever beat an NFL team.

```{r}
raptor_elo <- read_csv("C:\\Users\\jonah\\Downloads\\nba_elo_latest.csv")

raptor_elo <- raptor_elo |>
  mutate(elo_gap = abs(raptor1_pre - raptor2_pre),
         fav_won = (raptor1_pre > raptor2_pre & score1 > score2) 
                 | (raptor1_pre < raptor2_pre & score1 < score2))

fav_elo_plot <- ggplot(raptor_elo, aes(x = elo_gap, y = importance)) +
  geom_point(aes(color = fav_won), size = 1) +
  labs(x = "Elo Gap", y = "Importance", color = "Favorite Team Won?") +
  ggtitle("Impact of Importance on Favorite Teams Winning")

fav_elo_plot
```

## Results
```{r}
lm_model <- lm(fav_won ~ importance, data = raptor_elo) |>
  broom::tidy() |>
  knitr::kable(digits = 5,
               col.names = c("Term", "Coefficient", "Std. Error", "Statistic", "P-value"))

lm_model
```

First, the scatter plot is important for a few reasons. It shows that there aren't many games with high importance between teams with large elo gaps. This makes sense: a team with a very low elo probably has poor chances for making the playoffs or winning the championship, regardless of their performance in any given game. Since importance is calculated as an average of the individual importance a game holds for both teams in a game, the low importance brought by a bad team drags down the overall importance. However, the data is promising because it shows many important games where underdogs overcame elo gaps, and even moderately sized ones. More analysis needed to draw conclusions, though.

Now, we should break down the intercept data. The value of 0.693 is the probability that the favored team wins when controlling for importance; if all games had no importance, the favored team would be expected to win approximately 69.3\% of the time. The standard error was .02, meaning that this approximate has about two percentage points of uncertainty; we might expect the true probability to be somewhere between 67.3\% and 71.3\%. 

Next, importance. The coefficient was -.002; the negative sign indicates that as importance increases, the likelihood that the favored team won decreased. The value of .002 is by how much; as importance increased by one, the favored team had a .2 percentage point smaller chance of winning. The p-value is approximately .0001; this indicates a statistically significant impact of importance on whether or not the favored team won with an extremely high level of certainty. As such, I can reject the null hypothesis that importance has no impact on whether or not the favored team won; this data and my analysis suggests that importance has a statistically significant negative correlation with the performance of the favored team. I am hesitant to draw a conclusion from this due to the nature of it being a cross-sectional study. Since each game was only played once, we cannot tell with certainty what would happen if the exact same game was replayed with more or less importance. As such, we can only draw conclusions based on correlation. Moreover, several confounders may be present. I discuss these further in the conclusion.

## Conclusion
My results suggest a statistically significant negative correlation between importance and the performance of the favored team, since the coefficient was -.002 and the p-value was .0001. This provides very strong support for my hypothesis: that favored teams will have a lower chance of winning in games that are more important as opposed to games that are less important. Unfortunately, the presence of confounders muddles my certainty about this data. The largest confounder is individual team elo. Teams that are better are more likely to be championship contenders, and wins and losses therefore will have a larger sway on their championship odds. Conversely, terrible teams will be unlikely to win a championship or make a playoff, regardless of whether or not they win one game in an 82-game season. This problem grows as the season goes on: teams that have been eliminated from playoff contention will drag down the importance variable. This is a problem because it means that the games that we really care about the outcome in, games with large elo disparities and high importance, are hard to come by. The data set does not include individual importance ratings for each team, so I could not try to control for this by only taking  higher importance value between two teams in a game, or subsetting the data to include favored teams facing high importance values. Of course, individual team elo also impacts the outcome of a game -- the teams with the highest elos are unlikely to be underdogs and are more likely to the majority of their games, and teams with the lowest elos are very likely to be underdogs and lose the majority of their games. As such, both the importance values, and the binary variable of whether or not the favored team won, are heavily influenced by the elo values of the teams involved in the game. Additionally, teams do not always perform in ways that appear rational inside the scope of one game, and are only rational when considering the bigger picture. For instance, teams may lose games intentionally to try to bolster their chances of drafting an elite prospect; this was a large problem last season, since generational prospect Victor Wembanyama declared for the NBA Draft. Additionally, teams may choose to rest their best players before the playoffs or important games. All of these factors, as well as the nature of a cross-sectional study, make it difficult to declare a causal effect of importance on whether the favored team won. If I were to continue this analysis, I would attempt to obtain individual importance ratings as opposed to the average between two teams. Additionally, I would expand my dataset to include more seasons, and then subset the data to specifically examine high-importance games between teams with a moderate to large elo gap. There were simply not enough of these in the 2022-2023 season, as measured by the scatterplot, so expanding the dataset would be necessary. Still, I am comfortable saying that there is solid evidence of some negative correlation between importance and favored team performance, although it may be less certain and less significant than the p-value and coefficient indicated. 
